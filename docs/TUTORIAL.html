<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>T3/Wheat Tutorial • BrAPI</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="T3/Wheat Tutorial"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">BrAPI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>T3/Wheat Tutorial</h1>
      
    </div>


<div id="t3wheat-tutorial" class="section level1">
<p>This Tutorial uses the <code>BrAPI</code> R package to query the T3/Wheat Breedbase database for trials, phenotype data, and genotype data. The same functions should work the same for any BrAPI-compliant database (using v2 of the BrAPI specification).</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a></h2>
<p>With the <code>BrAPI</code> R packages installed, create a connection to the database.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wheat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getBrAPIConnection.html">getBrAPIConnection</a></span><span class="op">(</span><span class="st">"T3/Wheat"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="breeding-programs">Breeding Programs<a class="anchor" aria-label="anchor" href="#breeding-programs"></a></h2>
<p>If you’re guiding a user to select specific Trials, you might want to allow them to select a Breeding Program first to filter the number of trials they can select from.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">wheat</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/programs"</span>, page<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">programs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">resp</span><span class="op">$</span><span class="va">combined_data</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">$</span><span class="va">programName</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trials">Trials<a class="anchor" aria-label="anchor" href="#trials"></a></h2>
<p>If you want to give the user a list of trials to choose from, you can get a list of trial names and ids filtered by a selected breeding program:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_breeding_program</span> <span class="op">&lt;-</span> <span class="st">"University of Nebraska"</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">wheat</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/studies"</span>, query<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>programName<span class="op">=</span><span class="va">selected_breeding_program</span><span class="op">)</span>, page<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">resp</span><span class="op">$</span><span class="va">combined_data</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">studyDbId</span>, name<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">studyName</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trial-metadata">Trial Metadata<a class="anchor" aria-label="anchor" href="#trial-metadata"></a></h2>
<p>Once you have the trials you are interested in, you can get the trial metadata (such as trial location, design type, planting/harvest dates, year, etc):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_trials</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YldQtl-Val_2014_ClayCenter"</span>, <span class="st">"YldQtl-Val_2014_Lincoln"</span>, <span class="st">"YldQtl-Val_2014_Mead"</span>, <span class="st">"YldQtl-Val_2014_Sidney"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">trial_name</span> <span class="kw">in</span> <span class="va">selected_trials</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">wheat</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/studies"</span>, query<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>studyName<span class="op">=</span><span class="va">trial_name</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">trial_metadata</span> <span class="op">&lt;-</span> <span class="va">resp</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">trial_id</span> <span class="op">&lt;-</span> <span class="va">trial_metadata</span><span class="op">$</span><span class="va">studyDbId</span></span>
<span>  <span class="va">location</span> <span class="op">&lt;-</span> <span class="va">trial_metadata</span><span class="op">$</span><span class="va">locationName</span></span>
<span>  <span class="va">planting_date</span> <span class="op">&lt;-</span> <span class="va">trial_metadata</span><span class="op">$</span><span class="va">startDate</span></span>
<span>  <span class="va">harvest_date</span> <span class="op">&lt;-</span> <span class="va">trial_metadata</span><span class="op">$</span><span class="va">endDate</span></span>
<span>  <span class="va">design</span> <span class="op">&lt;-</span> <span class="va">trial_metadata</span><span class="op">$</span><span class="va">experimentalDesign</span><span class="op">$</span><span class="va">PUI</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trial-layout">Trial Layout<a class="anchor" aria-label="anchor" href="#trial-layout"></a></h2>
<p>The plot layout for a trial is defined by getting the relative plot positions. Each plot will have a row and column position if they were assigned when the trial was added to the database. To get the layout, you’ll need to get all of the plots (observation units) from the trial and extract the row and column information:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_trial_id</span> <span class="op">&lt;-</span> <span class="st">"6104"</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">wheat</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/observationunits"</span>, query<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>studyDbId<span class="op">=</span><span class="va">selected_trial_id</span><span class="op">)</span>, page<span class="op">=</span><span class="st">"all"</span>, pageSize<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">plot</span> <span class="kw">in</span> <span class="va">resp</span><span class="op">$</span><span class="va">combined_data</span> <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plot_id</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">$</span><span class="va">observationUnitDbId</span></span>
<span>  <span class="va">plot_name</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">$</span><span class="va">observationUnitName</span></span>
<span>  <span class="va">row</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">$</span><span class="va">observationUnitPosition</span><span class="op">$</span><span class="va">positionCoordinateY</span></span>
<span>  <span class="va">col</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">$</span><span class="va">observationUnitPosition</span><span class="op">$</span><span class="va">positionCoordinateX</span></span>
<span>  <span class="va">accession</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">$</span><span class="va">germplasmName</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="traits-accessions-and-trait-observations">Traits, Accessions, and Trait Observations<a class="anchor" aria-label="anchor" href="#traits-accessions-and-trait-observations"></a></h2>
<p>The recorded trait observations are accessible from the <code>/observations</code> BrAPI endpoint. In the response, each object in the data represents one observation (one value for a recorded trait / plot pair). The observation contains information about the plot, accession, and trait that was observed. The observations can be fetched for an entire trial by specifying the trial id:</p>
<p>```R # Get all of the observations for a single trial selected_trial_id &lt;- “6104” resp &lt;- wheat<span class="math inline">$get("/observations", query=list(studyDbId=selected_trial_id), page="all", pageSize=500) observations &lt;- resp$</span>combined_data</p>
</div>
</div>
<div class="section level1">
<h1 id="get-the-unique-set-of-trait-names-observed-in-this-trial">Get the unique set of trait names observed in this trial<a class="anchor" aria-label="anchor" href="#get-the-unique-set-of-trait-names-observed-in-this-trial"></a></h1>
<p>trait_names &lt;- sort(unique(sapply(observations, (x) { x$observationVariableName } )))</p>
</div>
<div class="section level1">
<h1 id="get-the-unique-set-of-accession-names-in-this-trial">Get the unique set of accession names in this trial<a class="anchor" aria-label="anchor" href="#get-the-unique-set-of-accession-names-in-this-trial"></a></h1>
<p>accession_names &lt;- sort(unique(sapply(observations, (x) { x$germplasmName } )))</p>
</div>
<div class="section level1">
<h1 id="build-a-long-format-table-of-trait-observations">Build a long-format table of trait observations<a class="anchor" aria-label="anchor" href="#build-a-long-format-table-of-trait-observations"></a></h1>
<p>data &lt;- tibble( plot_id = numeric(), plot_name = character(), accession_name = character(), trait_name = character(), value = numeric() )</p>
<p>for ( observation in observations ) { data &lt;- rbind(data, tibble( plot_id = as.numeric(observation<span class="math inline"><em>o</em><em>b</em><em>s</em><em>e</em><em>r</em><em>v</em><em>a</em><em>t</em><em>i</em><em>o</em><em>n</em><em>U</em><em>n</em><em>i</em><em>t</em><em>D</em><em>b</em><em>I</em><em>d</em>), <em>p</em><em>l</em><em>o</em><em>t</em><sub><em>n</em></sub><em>a</em><em>m</em><em>e</em> = <em>o</em><em>b</em><em>s</em><em>e</em><em>r</em><em>v</em><em>a</em><em>t</em><em>i</em><em>o</em><em>n</em></span>observationUnitName, accession_name = observation<span class="math inline"><em>g</em><em>e</em><em>r</em><em>m</em><em>p</em><em>l</em><em>a</em><em>s</em><em>m</em><em>N</em><em>a</em><em>m</em><em>e</em>, <em>t</em><em>r</em><em>a</em><em>i</em><em>t</em><sub><em>n</em></sub><em>a</em><em>m</em><em>e</em> = <em>o</em><em>b</em><em>s</em><em>e</em><em>r</em><em>v</em><em>a</em><em>t</em><em>i</em><em>o</em><em>n</em></span>observationVariableName, value = as.numeric(observation$value) )) }</p>
</div>
<div class="section level1"><h1 id="data">data:<a class="anchor" aria-label="anchor" href="#data"></a></h1></div>
<div class="section level1">
<h1 id="a-tibble-1759--5">A tibble: 1,759 × 5<a class="anchor" aria-label="anchor" href="#a-tibble-1759--5"></a></h1>
<p>plot_id plot_name accession_name trait_name value <dbl><chr><chr><chr><dbl> 1 1039253 YldQtl-Val_2014_ClayCenter_CT213_2127 CT213 Bacterial leaf streak severity - 0-9 percentage scale|CO_321:0501004 5<br>
2 1039253 YldQtl-Val_2014_ClayCenter_CT213_2127 CT213 Grain yield - kg/ha|CO_321:0001218 3410<br>
3 1039253 YldQtl-Val_2014_ClayCenter_CT213_2127 CT213 Plant height - cm|CO_321:0001301 82<br>
4 1039253 YldQtl-Val_2014_ClayCenter_CT213_2127 CT213 Grain protein content - %|CO_321:0001205 15.2 5 1039254 YldQtl-Val_2014_ClayCenter_NE13593_2297 NE13593 Bacterial leaf streak severity - 0-9 percentage scale|CO_321:0501004 2<br>
6 1039254 YldQtl-Val_2014_ClayCenter_NE13593_2297 NE13593 Grain yield - kg/ha|CO_321:0001218 3416<br>
7 1039254 YldQtl-Val_2014_ClayCenter_NE13593_2297 NE13593 Plant height - cm|CO_321:0001301 90<br>
8 1039254 YldQtl-Val_2014_ClayCenter_NE13593_2297 NE13593 Grain protein content - %|CO_321:0001205 16.4 9 1039255 YldQtl-Val_2014_ClayCenter_HW_98_2360 HW_98 Bacterial leaf streak severity - 0-9 percentage scale|CO_321:0501004 2<br>
10 1039255 YldQtl-Val_2014_ClayCenter_HW_98_2360 HW_98 Grain yield - kg/ha|CO_321:0001218 2993<br>
# ℹ 1,749 more rows # ℹ Use <code>print(n = ...)</code> to see more rows</dbl></chr></chr></chr></dbl></p>
</div>


  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by David Waring.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

